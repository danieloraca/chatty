<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>WebSocket Test</title>
  </head>
  <body>
    <h1>WebSocket Test</h1>

    <!-- Text field for user to enter message -->
    <div>
      <label for="message-input">Message to send:</label>
      <input type="text" id="message-input" />
    </div>

    <button id="connect-btn">Connect</button>
    <button id="send-btn">Send Message</button>

    <!-- Div to display AI output (accumulated tokens) -->
    <div id="response" style="white-space: pre-wrap"></div>

    <script>
      let socket = null;
      let partialResponse = ""; // accumulate partial tokens here

      document.getElementById("connect-btn").addEventListener("click", () => {
        socket = new WebSocket("ws://127.0.0.1:3456/ws");

        socket.onopen = () => {
          console.log("WebSocket is open now");
          document.getElementById("response").textContent = "Connected!";
          partialResponse = ""; // Clear or initialize
        };

        socket.onmessage = (event) => {
          console.log("Received:", event.data);

          // Append the newly received chunk to our accumulated text
          partialResponse += event.data;

          // Update the response div
          document.getElementById("response").textContent = partialResponse;
        };

        socket.onclose = () => {
          console.log("WebSocket is closed now");
          document.getElementById("response").textContent +=
            "\n[Connection closed]";
        };

        socket.onerror = (error) => {
          console.error("WebSocket error:", error);
          document.getElementById("response").textContent =
            "Error: " + error.message;
        };
      });

      document.getElementById("send-btn").addEventListener("click", () => {
        if (socket && socket.readyState === WebSocket.OPEN) {
          // Get the user's input
          const userMessage = document.getElementById("message-input").value;

          // Clear partialResponse if you want a fresh response each time
          partialResponse = "";

          // Send the user's message to the server
          socket.send(userMessage);
        } else {
          document.getElementById("response").textContent =
            "WebSocket is not open";
        }
      });
    </script>
  </body>
</html>
